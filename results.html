---
layout: page
title: Results
background:
---
<h1>Race Timer & Results</h1>

<h3>Upload Participant CSV</h3>
<input type="file" id="csvFile" accept=".csv">

<h3>Stopwatch</h3>
<span id="timer">00:00:00</span><br>
<button onclick="startTimer()">Start</button>
<button onclick="stopTimer()">Stop</button>
<button onclick="resetTimer()">Reset</button>

<h3>Participants</h3>
<table id="participantsTable">
  <thead>
    <tr>
      <th>Bib</th>
      <th>Name</th>
      <th>Age</th>
      <th>Gender</th>
      <th>Category</th>
      <th>Finish Time</th>
      <th>Record Time</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
  button { margin: 5px; }
</style>

<script>
// -------------------- Timer --------------------
let timerInterval;
let totalSeconds = 0;

function updateTimerDisplay() {
  let hrs = Math.floor(totalSeconds / 3600);
  let mins = Math.floor((totalSeconds % 3600) / 60);
  let secs = totalSeconds % 60;
  document.getElementById('timer').textContent =
    `${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

function startTimer() {
  if (!timerInterval) {
    timerInterval = setInterval(() => {
      totalSeconds++;
      updateTimerDisplay();
    }, 1000);
  }
}

function stopTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
}

function resetTimer() {
  stopTimer();
  totalSeconds = 0;
  updateTimerDisplay();
}

// -------------------- CSV Upload --------------------
document.getElementById('csvFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    parseCSV(text);
  };
  reader.readAsText(file);
});

let participants = [];

function parseCSV(text) {
  const rows = text.trim().split('\n');
  participants = rows.slice(1).map(row => {
    const [bib, name, age, gender] = row.split(',');
    return {
      bib: bib.trim(),
      name: name.trim(),
      age: parseInt(age.trim()),
      gender: gender.trim(),
      category: getCategory(parseInt(age.trim()), gender.trim()),
      finishTime: ''
    };
  });
  renderTable();
}

// -------------------- Category Assignment --------------------
function getCategory(age, gender) {
  if (gender.toUpperCase() === 'M') {
    if (age < 20) return 'Men 0-19';
    else if (age < 30) return 'Men 20-29';
    else if (age < 40) return 'Men 30-39';
    else return 'Men 40+';
  } else {
    if (age < 20) return 'Women 0-19';
    else if (age < 30) return 'Women 20-29';
    else if (age < 40) return 'Women 30-39';
    else return 'Women 40+';
  }
}

// -------------------- Render Table --------------------
function renderTable() {
  const tbody = document.querySelector('#participantsTable tbody');
  tbody.innerHTML = '';
  participants.forEach((p, index) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${p.bib}</td>
      <td>${p.name}</td>
      <td>${p.age}</td>
      <td>${p.gender}</td>
      <td>${p.category}</td>
      <td>${p.finishTime}</td>
      <td><button onclick="recordTime(${index})">Record Time</button></td>
    `;
    tbody.appendChild(row);
  });
}

// -------------------- Record Finish Time --------------------
function recordTime(index) {
  const hrs = Math.floor(totalSeconds / 3600);
  const mins = Math.floor((totalSeconds % 3600) / 60);
  const secs = totalSeconds % 60;
  const timeStr = `${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
  participants[index].finishTime = timeStr;
  // Sort participants by finish time
  participants.sort((a, b) => {
    if (!a.finishTime) return 1;
    if (!b.finishTime) return -1;
    return a.finishTime.localeCompare(b.finishTime);
  });
  renderTable();
}
</script>
